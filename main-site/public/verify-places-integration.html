<!DOCTYPE html>
<html>
<head>
    <title>Verify Places Integration</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        .test-section { border: 1px solid #ddd; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .test-section h2 { margin-top: 0; color: #555; }
        .form-row { display: flex; flex-wrap: wrap; margin: 0 -10px; }
        .form-group { flex: 1 1 300px; padding: 0 10px; margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #28a745; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        button:hover { background-color: #218838; }
        button.secondary { background-color: #6c757d; }
        button.secondary:hover { background-color: #5a6268; }
        button.danger { background-color: #dc3545; }
        button.danger:hover { background-color: #c82333; }
        .results { margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 4px; }
        .log { background-color: #e9ecef; padding: 15px; border-radius: 4px; margin: 10px 0; max-height: 300px; overflow-y: auto; }
        .success { color: #28a745; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-connected { background-color: #28a745; }
        .status-disconnected { background-color: #dc3545; }
        .status-loading { background-color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Google Places API Integration Verification</h1>
        
        <div class="test-section">
            <h2>Connection Status</h2>
            <div id="connectionStatus">
                <span class="status-indicator status-loading"></span>
                <span>Checking Google Places API connection...</span>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Hotel Registration Form Fields</h2>
            <p>This section simulates the actual hotel registration form fields with Places API integration.</p>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="hotel_name">Hotel Name:</label>
                    <input type="text" id="hotel_name" name="hotel_name" placeholder="Start typing a hotel name...">
                </div>
                
                <div class="form-group">
                    <label for="address">Hotel Address:</label>
                    <input type="text" id="address" name="address" placeholder="Start typing an address...">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="management_company_name">Management Company Name:</label>
                    <input type="text" id="management_company_name" name="management_company_name" placeholder="Start typing a company name...">
                </div>
                
                <div class="form-group">
                    <label for="management_company_address_full">Management Company Address:</label>
                    <input type="text" id="management_company_address_full" name="management_company_address_full" placeholder="Start typing an address...">
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button id="testAllFields">Test All Fields</button>
                <button id="clearFields" class="secondary">Clear Fields</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Integration Tests</h2>
            <p>Run these tests to verify that the Places API integration is working correctly.</p>
            
            <div style="text-align: center; margin: 20px 0;">
                <button id="runFullTest">Run Full Integration Test</button>
                <button id="testApiKey" class="secondary">Test API Key Only</button>
                <button id="testSearch" class="secondary">Test Search Functionality</button>
            </div>
            
            <div id="testResults" class="results" style="display: none;">
                <h3>Test Results</h3>
                <div id="resultsContent"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>API Activity Log</h2>
            <div id="apiLog" class="log">
                <p>API activity will be logged here...</p>
            </div>
            <div style="text-align: center; margin-top: 10px;">
                <button id="clearLog" class="secondary">Clear Log</button>
            </div>
        </div>
    </div>

    <script>
        let googlePlacesApiKey = null;
        let isApiConnected = false;
        
        // Log messages to the UI
        function logMessage(message, type = 'info') {
            const logDiv = document.getElementById('apiLog');
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = type === 'error' ? 'error' : type === 'warning' ? 'warning' : type === 'success' ? 'success' : '';
            logDiv.innerHTML += `<p class="${typeClass}">[${timestamp}] ${message}</p>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // Update connection status
        function updateConnectionStatus(status, message) {
            const statusDiv = document.getElementById('connectionStatus');
            let statusClass = '';
            let indicatorClass = '';
            
            switch(status) {
                case 'connected':
                    statusClass = 'success';
                    indicatorClass = 'status-connected';
                    break;
                case 'disconnected':
                    statusClass = 'error';
                    indicatorClass = 'status-disconnected';
                    break;
                case 'loading':
                    statusClass = 'warning';
                    indicatorClass = 'status-loading';
                    break;
            }
            
            statusDiv.innerHTML = `
                <span class="status-indicator ${indicatorClass}"></span>
                <span class="${statusClass}">${message}</span>
            `;
        }
        
        // Display test results
        function displayResults(content) {
            const resultsDiv = document.getElementById('testResults');
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = content;
            resultsDiv.style.display = 'block';
        }
        
        // Clear test results
        function clearResults() {
            const resultsDiv = document.getElementById('testResults');
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = '';
            resultsDiv.style.display = 'none';
        }
        
        // Load Google Places API key from server
        async function loadGooglePlacesAPI() {
            try {
                updateConnectionStatus('loading', 'Loading Google Places API key...');
                logMessage('Requesting Google Places API key from server...');
                
                const response = await fetch('/api/google-places-key');
                
                if (!response.ok) {
                    throw new Error(`Server responded with status ${response.status}`);
                }
                
                const data = await response.json();
                logMessage('Received response from server: ' + JSON.stringify(data));
                
                if (data.mockMode) {
                    logMessage('Development Mode: Google Places API not configured, using mock data', 'warning');
                    updateConnectionStatus('disconnected', 'Development Mode: API not configured');
                    isApiConnected = false;
                    return false;
                }
                
                if (data && data.apiKey) {
                    googlePlacesApiKey = data.apiKey;
                    logMessage('Google Places API key loaded successfully', 'success');
                    updateConnectionStatus('connected', 'Connected to Google Places API');
                    isApiConnected = true;
                    return true;
                } else {
                    logMessage('Google Places API key not available in response', 'error');
                    updateConnectionStatus('disconnected', 'API key not available');
                    isApiConnected = false;
                    return false;
                }
            } catch (error) {
                logMessage('Error loading Google Places API: ' + error.message, 'error');
                updateConnectionStatus('disconnected', 'Failed to connect to Google Places API');
                isApiConnected = false;
                return false;
            }
        }
        
        // Search for places using the new Google Places API
        async function searchPlaces(query, maxResults = 3) {
            if (!googlePlacesApiKey) {
                logMessage('Google Places API key not available for search', 'error');
                return null;
            }
            
            try {
                logMessage(`Searching for places: "${query}"`);
                const response = await fetch(`https://places.googleapis.com/v1/places:searchText`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Goog-Api-Key': googlePlacesApiKey,
                        'X-Goog-FieldMask': 'places.id,places.displayName,places.formattedAddress,places.addressComponents,places.internationalPhoneNumber,places.websiteUri'
                    },
                    body: JSON.stringify({
                        textQuery: query,
                        maxResultCount: maxResults
                    })
                });
                
                const responseText = await response.text();
                
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}: ${responseText}`);
                }
                
                const data = JSON.parse(responseText);
                logMessage(`Search completed. Found ${data.places ? data.places.length : 0} results`, 'success');
                return data;
            } catch (error) {
                logMessage('Error searching places: ' + error.message, 'error');
                return null;
            }
        }
        
        // Test API key only
        async function testApiKeyOnly() {
            clearResults();
            logMessage('Starting API key test...');
            
            const apiLoaded = await loadGooglePlacesAPI();
            
            if (apiLoaded) {
                displayResults(`
                    <p class="success">✓ API Key Test PASSED</p>
                    <p>Google Places API key successfully loaded from server.</p>
                    <p>Key prefix: ${googlePlacesApiKey ? googlePlacesApiKey.substring(0, 10) + '...' : 'N/A'}</p>
                `);
            } else {
                displayResults(`
                    <p class="error">✗ API Key Test FAILED</p>
                    <p>Could not load Google Places API key from server.</p>
                    <p>Please check that the GOOGLE_PLACES_API_KEY is properly configured in your .env file.</p>
                `);
            }
        }
        
        // Test search functionality
        async function testSearchFunctionality() {
            clearResults();
            logMessage('Starting search functionality test...');
            
            if (!isApiConnected) {
                displayResults(`
                    <p class="error">✗ Search Test FAILED</p>
                    <p>Google Places API is not connected. Please run the API key test first.</p>
                `);
                return;
            }
            
            // Test with a common query
            const testQuery = 'Marriott';
            logMessage(`Testing search with query: "${testQuery}"`);
            
            const results = await searchPlaces(testQuery, 2);
            
            if (results && results.places && results.places.length > 0) {
                let resultsHtml = '<ul>';
                results.places.forEach(place => {
                    resultsHtml += `<li><strong>${place.displayName.text}</strong></li>`;
                });
                resultsHtml += '</ul>';
                
                displayResults(`
                    <p class="success">✓ Search Test PASSED</p>
                    <p>Successfully searched for "${testQuery}" and found ${results.places.length} results:</p>
                    ${resultsHtml}
                `);
            } else {
                displayResults(`
                    <p class="warning">⚠ Search Test INCONCLUSIVE</p>
                    <p>API connection is working, but no results found for query "${testQuery}".</p>
                    <p>This could be due to the query or temporary API issues.</p>
                `);
            }
        }
        
        // Run full integration test
        async function runFullIntegrationTest() {
            clearResults();
            logMessage('Starting full integration test...');
            
            // Test 1: API Key
            displayResults('<p>Test 1: API Key Loading...</p>');
            const apiLoaded = await loadGooglePlacesAPI();
            
            if (!apiLoaded) {
                displayResults(`
                    <p class="error">✗ Integration Test FAILED</p>
                    <p>Test 1 FAILED: Could not load Google Places API key.</p>
                `);
                return;
            }
            
            displayResults('<p class="success">✓ Test 1 PASSED: API Key Loaded</p><p>Test 2: Search Functionality...</p>');
            
            // Test 2: Search with multiple queries
            const testQueries = [
                { name: 'Hotel Name', query: 'Hilton' },
                { name: 'Address', query: 'Times Square' },
                { name: 'Management Company', query: 'Marriott' }
            ];
            
            let allTestsPassed = true;
            let resultsHtml = '<p class="success">✓ Test 1 PASSED: API Key Loaded</p>';
            
            for (const test of testQueries) {
                logMessage(`Testing ${test.name} search with query: "${test.query}"`);
                const results = await searchPlaces(test.query, 1);
                
                if (results && results.places && results.places.length > 0) {
                    resultsHtml += `<p class="success">✓ Test ${testQueries.indexOf(test) + 2} PASSED: ${test.name} Search</p>`;
                } else {
                    resultsHtml += `<p class="warning">⚠ Test ${testQueries.indexOf(test) + 2} INCONCLUSIVE: ${test.name} Search (No results)</p>`;
                    // Don't fail the entire test for no results
                }
            }
            
            resultsHtml += `<p class="success">🎉 All integration tests completed!</p>`;
            displayResults(resultsHtml);
        }
        
        // Test all form fields
        async function testAllFields() {
            logMessage('Testing autocomplete on all form fields...');
            
            if (!isApiConnected) {
                logMessage('Cannot test fields: Google Places API is not connected', 'error');
                return;
            }
            
            const fields = [
                { id: 'hotel_name', name: 'Hotel Name', testValue: 'Sheraton' },
                { id: 'address', name: 'Hotel Address', testValue: '123 Main St' },
                { id: 'management_company_name', name: 'Management Company', testValue: 'Hilton' },
                { id: 'management_company_address_full', name: 'Management Company Address', testValue: '456 Business Ave' }
            ];
            
            for (const field of fields) {
                const element = document.getElementById(field.id);
                if (element) {
                    element.value = field.testValue;
                    logMessage(`Set ${field.name} field to: "${field.testValue}"`);
                }
            }
            
            logMessage('All fields populated with test values', 'success');
        }
        
        // Clear all form fields
        function clearAllFields() {
            const fields = ['hotel_name', 'address', 'management_company_name', 'management_company_address_full'];
            
            fields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.value = '';
                }
            });
            
            logMessage('All form fields cleared');
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', async function() {
            logMessage('Page loaded, initializing Google Places API connection...');
            
            // Load API key on page load
            await loadGooglePlacesAPI();
            
            // Set up event listeners
            document.getElementById('testApiKey').addEventListener('click', testApiKeyOnly);
            document.getElementById('testSearch').addEventListener('click', testSearchFunctionality);
            document.getElementById('runFullTest').addEventListener('click', runFullIntegrationTest);
            document.getElementById('testAllFields').addEventListener('click', testAllFields);
            document.getElementById('clearFields').addEventListener('click', clearAllFields);
            document.getElementById('clearLog').addEventListener('click', function() {
                document.getElementById('apiLog').innerHTML = '<p>Log cleared.</p>';
            });
            
            // Set up autocomplete simulation for form fields
            const fields = ['hotel_name', 'address', 'management_company_name', 'management_company_address_full'];
            
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    let debounceTimer;
                    field.addEventListener('input', function() {
                        clearTimeout(debounceTimer);
                        const query = this.value;
                        
                        if (query.length >= 3) {
                            debounceTimer = setTimeout(() => {
                                logMessage(`Autocomplete would trigger for ${fieldId}: "${query}"`, 'info');
                                // In the real implementation, this would call the Places API
                            }, 300);
                        }
                    });
                }
            });
        });
    </script>
    <script src="/footer.js"></script>
<footer id="contact">
    <div class="container">
        <div class="footer-content">
            <div class="footer-section">
                <h3>FEDEVENT</h3>
                <p>Professional event planning services for U.S. Government agencies.</p>
            </div>
            <div class="footer-section">
                <h3>Services</h3>
                <a href="/hotel-signup.html">Hotel Sourcing</a>
                <a href="/contact.html">Event Planning</a>
                <a href="/government-portal.html">Venue Matching</a>
                <a href="/support-ticket.html">Support Ticket</a>
            </div>
            <div class="footer-section footer-contact">
                <h3>Contact</h3>
                <p>Email: info@fedevent.com</p>
                <p>Phone: (305) 850-7848</p>
                <a href="/admin-login.html" style="color: #d1d5db; text-decoration: none; margin-top: 10px; display: inline-block; padding: 5px 10px; border: 1px solid #374151; border-radius: 4px; font-size: 0.9rem;">
                    🔐 Admin Access
                </a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>fedevent.com is a service of CREATA Global Event Agency LLC</p>
            <p>&copy; 2025 FEDEVENT. All rights reserved.</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                <a href="/admin-login.html" style="color: #9ca3af; text-decoration: none; border-bottom: 1px dotted #9ca3af;">
                    🔐 Admin Sign In
                </a>
            </p>
        </div>
    </div>
</footer>

<style>
    /* Footer Styles */
    footer {
        background: var(--text, #1f2937);
        color: white;
        padding: 3rem 0 1rem;
        margin-top: auto;
    }

    .footer-content {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .footer-section h3 {
        margin-bottom: 1rem;
        color: var(--secondary, #f59e0b);
    }

    .footer-section a {
        display: block;
        color: #d1d5db;
        text-decoration: none;
        margin-bottom: 0.5rem;
        transition: color 0.2s;
    }

    .footer-section a:hover {
        color: var(--secondary, #f59e0b);
    }

    .footer-contact {
        text-align: right;
    }

    .footer-bottom {
        border-top: 1px solid #374151;
        padding-top: 2rem;
        text-align: center;
        color: #9ca3af;
    }

    /* Responsive Footer */
    @media (max-width: 768px) {
        .footer-content {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        .footer-contact {
            text-align: left;
        }
    }
</style>
</body>
</html>