<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Details - FEDEVENT Admin</title>
    <link rel="stylesheet" href="/site.css">
</head>
<body style="font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background:#f8fafc; color:#111827;">
    <div style="max-width:960px;margin:24px auto;padding:0 16px;">
        <a href="/admin-contracts.html" style="text-decoration:none;color:#1e40af;">‚Üê Back to Contracts</a>
        <h1 id="title" style="margin:12px 0 16px 0; font-size:28px;">Contract Details</h1>
        <div id="meta" style="background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin-bottom:16px;"></div>
        <div id="sow" style="background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin-bottom:16px;"></div>
        <div id="event" style="background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;"></div>
    </div>

    <script>
        (function(){
            const sessionId = localStorage.getItem('sessionId');
            const user = JSON.parse(localStorage.getItem('user')||'null');
            if (!sessionId || !user || user.role !== 'admin') { window.location.replace('/admin-login.html'); return; }
        })();

        const params = new URLSearchParams(location.search);
        const id = params.get('id');
        if (!id) { document.body.innerHTML = '<div style="padding:24px;">Missing contract id.</div>'; }

        function fmt(d){ if(!d) return '-'; const x=new Date(d); const dd=String(x.getDate()).padStart(2,'0'); const mmm=x.toLocaleString('en-US',{month:'short'}).toUpperCase(); const yy=String(x.getFullYear()).slice(-2); return `${dd}/${mmm}/${yy}`; }

        async function load(){
            const sessionId = localStorage.getItem('sessionId');
            const r = await fetch(`/api/admin/contracts/${id}`, { headers:{ 'Authorization': `Bearer ${sessionId}` } });
            const data = await r.json();
            if (!data.ok) { document.body.innerHTML = '<div style="padding:24px;color:#b91c1c;">Failed to load contract.</div>'; return; }
            const c = data.contract;
            document.getElementById('title').textContent = c.title || 'Contract Details';
            document.getElementById('meta').innerHTML = `
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;">
                    <div><strong>Location</strong><div>${[c.location_city,c.location_state,c.location_country].filter(Boolean).join(', ')||'-'}</div></div>
                    <div><strong>Period</strong><div>${fmt(c.start_date)} to ${fmt(c.end_date)}</div></div>
                    <div><strong>Rooms</strong><div>${c.room_count||'-'}</div></div>
                    <div><strong>Status</strong><div>${c.status||'-'}</div></div>
                </div>`;
            document.getElementById('sow').innerHTML = `
                <h3 style="margin:0 0 8px 0;">SOW Summary</h3>
                <pre style="white-space:pre-wrap; font-family:ui-monospace,Menlo,monospace; background:#f9fafb; padding:12px; border-radius:8px; border:1px solid #e5e7eb;">${(c.sow_document||'').slice(0,20000)}</pre>`;

            // event specific (best-effort via description lines)
            const e = [];
            if (c.description) {
                const d = c.description;
                const pushIf = (label, rx) => { const m = d.match(rx); if (m) e.push(`<div><strong>${label}</strong> ${m[1]||m[0]}</div>`); };
                pushIf('Sleeping Rooms:', /(\d{1,4})\s+(?:sleeping\s*)?rooms?/i);
                pushIf('Meeting Space:', /(\d{3,6})\s*(?:sq\.?\s*ft|square\s*feet|sf)/i);
                pushIf('Meeting Rooms:', /(\d{1,3})\s*(meeting|breakout)\s*rooms?/i);
                if (/\b(A\/?V|audio\s*visual|projector|screen|microphone)\b/i.test(d)) e.push('<div><strong>AV:</strong> Required</div>');
                if (/\b(meals?|catering|breakfast|lunch|dinner)\b/i.test(d)) e.push('<div><strong>Meals/Catering:</strong> Yes</div>');
            }
            document.getElementById('event').innerHTML = `<h3 style="margin:0 0 8px 0;">Event Requirements</h3>${e.join('')||'<div>-</div>'}`;
        }
        load();
    </script>
</body>
</html>

