<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Search - Government Portal | FEDEVENT</title>
    
    <!-- Google Analytics 4 (GA4) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX', {
            // Enhanced ecommerce and event tracking
            send_page_view: true,
            custom_map: {
                'custom_parameter_1': 'government_portal'
            }
        });
        
        // Custom event tracking functions
        function trackSearch(searchData) {
            gtag('event', 'hotel_search', {
                'event_category': 'Government Portal',
                'event_label': 'Hotel Search',
                'custom_parameter_1': 'government_portal',
                'search_term': searchData.keywords || '',
                'search_city': searchData.city || '',
                'search_state': searchData.state || '',
                'search_country': searchData.country || '',
                'filters_applied': JSON.stringify(searchData.filters || {})
            });
        }
        
        function trackQuoteRequest(hotelId) {
            gtag('event', 'quote_request', {
                'event_category': 'Government Portal',
                'event_label': 'Hotel Quote Request',
                'custom_parameter_1': 'government_portal',
                'hotel_id': hotelId,
                'value': 1
            });
        }
        
        function trackHotelView(hotelId) {
            gtag('event', 'hotel_view', {
                'event_category': 'Government Portal',
                'event_label': 'Hotel Details View',
                'custom_parameter_1': 'government_portal',
                'hotel_id': hotelId
            });
        }
        
        function trackFilterChange(filterName, filterValue) {
            gtag('event', 'filter_change', {
                'event_category': 'Government Portal',
                'event_label': 'Search Filter Changed',
                'custom_parameter_1': 'government_portal',
                'filter_name': filterName,
                'filter_value': filterValue
            });
        }
    </script>
    <style>
        :root {
            --primary: #1f2937;
            --secondary: #3b82f6;
            --text: #374151;
            --text-light: #6b7280;
            --bg: #f9fafb;
            --white: #ffffff;
            --border: #e5e7eb;
            --success: #16a34a;
            --warning: #f59e0b;
            --error: #dc2626;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
        }
        
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
        }
        
        .nav-links a {
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        
        .nav-links a:hover,
        .nav-links a.active {
            background: var(--bg);
            color: var(--primary);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-info {
            font-weight: 500;
        }
        
        .header-nav {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .logout-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 2rem;
        }
        
        .search-section {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }
        
        .search-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            align-items: end;
        }
        
        .search-form .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text);
        }
        
        .form-group input,
        .form-group select {
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        .search-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .search-btn:hover {
            background: #2563eb;
        }
        
        .results-section {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .results-count {
            color: var(--text-light);
            font-size: 0.875rem;
        }
        
        .hotel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }
        
        .hotel-card {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            background: var(--bg);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .hotel-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .hotel-header {
            margin-bottom: 1rem;
        }
        
        .hotel-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .hotel-location {
            color: var(--text-light);
            font-size: 0.875rem;
        }
        
        .hotel-details {
            margin-bottom: 1.5rem;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .detail-label {
            color: var(--text-light);
        }
        
        .detail-value {
            font-weight: 600;
            color: var(--text);
        }
        
        .hotel-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .tag {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .tag-government {
            background: #dcfce7;
            color: #15803d;
        }
        
        .tag-net30 {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .tag-perdiem {
            background: #fef3c7;
            color: #92400e;
        }
        
        .hotel-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-size: 0.875rem;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-outline {
            background: transparent;
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }
        
        .btn-outline:hover {
            background: var(--secondary);
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }
        
        .error-message {
            background: #fef2f2;
            color: var(--error);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #16a34a;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .filters-section {
            margin-bottom: 1.5rem;
        }
        
        .filters-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
        }
        
        .filter-checkboxes {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .checkbox-group label {
            font-weight: normal;
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .hotel-grid {
                grid-template-columns: 1fr;
            }
            
            .hotel-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">FEDEVENT</div>
            <div class="header-nav">
                <div class="nav-links">
                    <a href="/government-dashboard.html">Dashboard</a>
                    <a href="/government-hotel-search.html" class="active">Hotel Search</a>
                </div>
                <div class="user-menu">
                    <div class="user-info" id="userInfo">Loading...</div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h1 class="page-title">üîç Hotel Network Search</h1>
        
        <div class="search-section">
            <h2 style="margin-bottom: 1.5rem; color: var(--primary);">Search Government-Qualified Hotels</h2>
            
            <div id="errorMessage" class="error-message"></div>
            
            <form class="search-form" id="searchForm">
                <!-- Row 1: Location Type + State/Continent + Country -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="locationType">Select Location</label>
                        <select id="locationType" name="locationType" onchange="toggleLocationFields()">
                            <option value="">Choose location type</option>
                            <option value="CONUS">CONUS (Continental United States)</option>
                            <option value="OCONUS">OCONUS (Outside Continental United States)</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="conusFields" style="display: none;">
                        <label for="state">State</label>
                        <select id="state" name="state">
                            <option value="">All States</option>
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="DC">District of Columbia</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="oconusFields" style="display: none;">
                        <label for="continent">Continent</label>
                        <select id="continent" name="continent" onchange="updateCountryOptions()">
                            <option value="">Select Continent</option>
                            <option value="North America">North America</option>
                            <option value="Europe">Europe</option>
                            <option value="Asia">Asia</option>
                            <option value="Oceania">Oceania</option>
                            <option value="South America">South America</option>
                            <option value="Africa">Africa</option>
                            <option value="Middle East">Middle East</option>
                        </select>
                    </div>
                </div>
                
                <!-- Row 2: Country -->
                <div class="form-row">
                    <div class="form-group" id="countryField" style="display: none;">
                        <label for="country">Country</label>
                        <select id="country" name="country">
                            <option value="">Select Country</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <!-- Empty space for alignment -->
                    </div>
                    
                    <div class="form-group">
                        <!-- Empty space for alignment -->
                    </div>
                </div>
                
                <!-- Row 3: All Text Inputs -->
                <div class="form-row">
                    <div class="form-group" id="cityField" style="display: none;">
                        <label for="city">City</label>
                        <input type="text" id="city" name="city" placeholder="Enter city name">
                    </div>
                    
                    <div class="form-group">
                        <label for="keywords">Hotel Name or Brand</label>
                        <input type="text" id="keywords" name="keywords" placeholder="Marriott, Hilton, Holiday Inn, etc.">
                    </div>
                    
                    <div class="form-group">
                        <label for="checkin">Check-in Date</label>
                        <input type="date" id="checkin" name="checkin">
                    </div>
                </div>
                
                <!-- Row 4: More Text Inputs -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="checkout">Check-out Date</label>
                        <input type="date" id="checkout" name="checkout">
                    </div>
                    
                    <div class="form-group">
                        <!-- Empty space for alignment -->
                    </div>
                    
                    <div class="form-group">
                        <!-- Empty space for alignment -->
                    </div>
                </div>
                
                <!-- Row 5: All Dropdowns -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="rooms">Number of Rooms</label>
                        <select id="rooms" name="rooms">
                            <option value="">Any</option>
                            <option value="1">1 Room</option>
                            <option value="2">2 Rooms</option>
                            <option value="3">3 Rooms</option>
                            <option value="4">4 Rooms</option>
                            <option value="5">5 Rooms</option>
                            <option value="6">6 Rooms</option>
                            <option value="7">7 Rooms</option>
                            <option value="8">8 Rooms</option>
                            <option value="9">9 Rooms</option>
                            <option value="10">10+ Rooms</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <!-- Empty space for alignment -->
                    </div>
                    
                    <div class="form-group">
                        <!-- Empty space for alignment -->
                    </div>
                </div>
                
                <!-- Row 6: Search Button -->
                <div class="form-row">
                    <div class="form-group">
                        <button type="submit" class="search-btn" onclick="searchHotels()">üîç Search Hotels</button>
                    </div>
                    
                    <div class="form-group">
                        <!-- Empty space for alignment -->
                    </div>
                    
                    <div class="form-group">
                        <!-- Empty space for alignment -->
                    </div>
                </div>
            </form>
        </div>
        
        <div class="results-section">
            <div class="results-header">
                <h2 style="color: var(--primary);">Search Results</h2>
                <div class="results-count" id="resultsCount">Ready to search</div>
            </div>
            
            <div id="hotelResults" class="hotel-grid">
                <div class="loading">
                    <p>Enter search criteria above to find government-qualified hotels in our network.</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Check authentication (bypass for development)
        const sessionToken = localStorage.getItem('gov_session') || 'dev-bypass-token';
        // if (!sessionToken) {
        //     window.location.href = '/government-login.html';
        // }
        
        // Load user info (bypass for development)
        async function loadUserInfo() {
            try {
                // For development bypass, use mock user data
                if (sessionToken === 'dev-bypass-token') {
                    document.getElementById('userInfo').textContent = 'Development User - Test Agency';
                    return;
                }
                
                const response = await fetch('/api/government/me', {
                    headers: {
                        'Authorization': `Bearer ${sessionToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('userInfo').textContent = 
                        `${data.user.first_name} ${data.user.last_name} - ${data.user.agency}`;
                } else {
                    logout();
                }
            } catch (error) {
                console.error('Failed to load user info:', error);
                // Don't logout on error in development mode
                if (sessionToken !== 'dev-bypass-token') {
                logout();
                }
            }
        }
        
        // Search hotels function - shows no results and mission support form
        async function searchHotels() {
            const errorDiv = document.getElementById('errorMessage');
            const resultsDiv = document.getElementById('hotelResults');
            const countDiv = document.getElementById('resultsCount');
            
            // Get form data
            const locationType = document.getElementById('locationType').value;
            const city = document.getElementById('city').value.trim();
            const state = document.getElementById('state').value;
            const continent = document.getElementById('continent').value;
            const country = document.getElementById('country').value;
            const checkin = document.getElementById('checkin').value;
            const checkout = document.getElementById('checkout').value;
            const rooms = document.getElementById('rooms').value;
            const keywords = document.getElementById('keywords').value.trim();
            
            errorDiv.style.display = 'none';
            resultsDiv.innerHTML = '<div class="loading">Searching hotels...</div>';
            countDiv.textContent = 'Searching...';
            
            // Simulate search delay
            setTimeout(() => {
                // Always show no results with mission support form
                resultsDiv.innerHTML = `
                    <div style="text-align: center; padding: 2rem; background: #f8fafc; border-radius: 12px; margin: 1rem 0;">
                        <h3 style="color: #1f2937; margin-bottom: 1rem;">üîç No Hotels Found in Network</h3>
                        <p style="color: #6b7280; margin-bottom: 1.5rem;">
                            We don't have any hotels in our network matching your criteria yet. 
                            To source hotels outside our network, please fill out the mission support form below.
                        </p>
                        
                        <div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 2rem; margin: 2rem 0; text-align: left;">
                            <h4 style="color: #1f2937; margin-top: 0; margin-bottom: 1.5rem;">üìã Mission Support Request</h4>
                            
                            <form id="missionForm" onsubmit="submitMissionRequest(event)">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Mission Type *</label>
                                        <select id="missionType" name="missionType" required style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                                            <option value="">Select Mission Type</option>
                                            <option value="Training">Training</option>
                                            <option value="Conference">Conference</option>
                                            <option value="Meeting">Meeting</option>
                                            <option value="Deployment">Deployment</option>
                                            <option value="Exercise">Exercise</option>
                                            <option value="Inspection">Inspection</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Agency/Department *</label>
                                        <input type="text" id="agency" name="agency" placeholder="e.g., Department of Defense, FEMA" required style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Contact Name *</label>
                                        <input type="text" id="contactName" name="contactName" required style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Contact Email *</label>
                                        <input type="email" id="contactEmail" name="contactEmail" required style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Contact Phone *</label>
                                        <input type="tel" id="contactPhone" name="contactPhone" required style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Estimated Budget</label>
                                        <input type="text" id="budget" name="budget" placeholder="e.g., $50,000, $100,000+" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Special Requirements</label>
                                    <textarea id="specialRequirements" name="specialRequirements" rows="3" placeholder="Any specific hotel requirements, accessibility needs, security requirements, etc." style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; resize: vertical;"></textarea>
                                </div>
                                
                                <button type="submit" style="background: #1e40af; color: white; padding: 0.75rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%;">
                                    Submit Mission Request
                                </button>
                            </form>
                        </div>
                        
                        <div style="background: #e0f2fe; border: 1px solid #b3e5fc; border-radius: 8px; padding: 1rem; margin-top: 1rem;">
                            <p style="color: #0277bd; margin: 0; font-size: 0.9rem;">
                                <strong>üí° What happens next?</strong> We'll review your requirements and source qualified hotels outside our network. Expected response time: 24-48 hours.
                            </p>
                        </div>
                    </div>
                `;
                countDiv.textContent = 'No hotels found - Mission support available';
            }, 1000);
        }
        
        // Submit mission request function
        async function submitMissionRequest(event) {
            event.preventDefault();
            
            const errorDiv = document.getElementById('errorMessage');
            
            // Get form data
            const locationType = document.getElementById('locationType').value;
            const city = document.getElementById('city').value.trim();
            const state = document.getElementById('state').value;
            const continent = document.getElementById('continent').value;
            const country = document.getElementById('country').value;
            const checkin = document.getElementById('checkin').value;
            const checkout = document.getElementById('checkout').value;
            const rooms = document.getElementById('rooms').value;
            const keywords = document.getElementById('keywords').value.trim();
            const missionType = document.getElementById('missionType').value;
            const agency = document.getElementById('agency').value.trim();
            const contactName = document.getElementById('contactName').value.trim();
            const contactEmail = document.getElementById('contactEmail').value.trim();
            const contactPhone = document.getElementById('contactPhone').value.trim();
            const specialRequirements = document.getElementById('specialRequirements').value.trim();
            const budget = document.getElementById('budget').value.trim();
            
            // Basic validation
            if (!missionType || !agency || !contactName || !contactEmail || !contactPhone) {
                errorDiv.textContent = 'Please fill in all required fields.';
                errorDiv.style.display = 'block';
                return;
            }
            
            // Hide previous messages
            errorDiv.style.display = 'none';
            
            try {
                // Prepare mission request data
                const missionData = {
                    locationType: locationType,
                    city: city,
                    state: state,
                    continent: continent,
                    country: country,
                    checkin: checkin,
                    checkout: checkout,
                    rooms: rooms,
                    keywords: keywords,
                    missionType: missionType,
                    agency: agency,
                    contactName: contactName,
                    contactEmail: contactEmail,
                    contactPhone: contactPhone,
                    specialRequirements: specialRequirements,
                    budget: budget,
                    submittedAt: new Date().toISOString()
                };
                
                // Send mission request
                const response = await fetch('/api/government/mission-request', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionToken}`
                    },
                    body: JSON.stringify(missionData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                    const data = await response.json();
                
                if (data.success) {
                    // Show success message
                    document.getElementById('hotelResults').innerHTML = `
                        <div style="text-align: center; padding: 2rem; background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 12px; margin: 1rem 0;">
                            <h3 style="color: #16a34a; margin-bottom: 1rem;">‚úÖ Mission Request Submitted Successfully!</h3>
                            <p style="color: #15803d; margin-bottom: 1rem;">Thank you for submitting your mission support request. Our team will review your requirements and source qualified hotels for you.</p>
                            <p style="color: #15803d; font-weight: 600;">Expected response time: 24-48 hours</p>
                        </div>
                    `;
                    
                } else {
                    throw new Error(data.message || 'Submission failed');
                }
                
            } catch (error) {
                console.error('Submission error:', error);
                errorDiv.textContent = `Submission failed: ${error.message}`;
                errorDiv.style.display = 'block';
            }
        }
        
        // Display hotels function
        function displayHotels(hotels) {
            const resultsDiv = document.getElementById('hotelResults');
            
            if (hotels.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="loading">
                        <p>No hotels found matching your search criteria.</p>
                        <p style="margin-top: 1rem; font-size: 0.875rem; color: var(--text-light);">
                            Try adjusting your filters or search terms.
                        </p>
                    </div>
                `;
                return;
            }
            
            resultsDiv.innerHTML = hotels.map(hotel => `
                <div class="hotel-card">
                    <div class="hotel-header">
                        <div class="hotel-name">${hotel.name || 'Unnamed Hotel'}</div>
                        <div class="hotel-location">
                            üìç ${[hotel.city, hotel.state, hotel.country].filter(Boolean).join(', ') || 'Location not specified'}
                        </div>
                    </div>
                    
                    <div class="hotel-details">
                        ${hotel.email ? `
                            <div class="detail-row">
                                <span class="detail-label">Contact Email:</span>
                                <span class="detail-value">${hotel.email}</span>
                            </div>
                        ` : ''}
                        ${hotel.phone ? `
                            <div class="detail-row">
                                <span class="detail-label">Phone:</span>
                                <span class="detail-value">${hotel.phone}</span>
                            </div>
                        ` : ''}
                        ${hotel.total_rooms ? `
                            <div class="detail-row">
                                <span class="detail-label">Total Rooms:</span>
                                <span class="detail-value">${hotel.total_rooms}</span>
                            </div>
                        ` : ''}
                        <div class="detail-row">
                            <span class="detail-label">Registered:</span>
                            <span class="detail-value">${formatDate(hotel.created_at)}</span>
                        </div>
                    </div>
                    
                    <div class="hotel-tags">
                        <span class="tag tag-government">‚úÖ Government Qualified</span>
                        <span class="tag tag-net30">üí≥ NET30 Terms</span>
                        ${hotel.per_diem_rates ? '<span class="tag tag-perdiem">üèõÔ∏è Per Diem Available</span>' : ''}
                    </div>
                    
                    <div class="hotel-actions">
                        <button class="btn btn-primary" onclick="requestQuote(${hotel.id})">
                            üìã Request Quote
                        </button>
                        <button class="btn btn-outline" onclick="viewDetails(${hotel.id})">
                            ‚ÑπÔ∏è View Details
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Format date helper
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleDateString();
        }
        
        // Request quote function
        async function requestQuote(hotelId) {
            try {
                // Track quote request event
                if (typeof trackQuoteRequest === 'function') {
                    trackQuoteRequest(hotelId);
                }
                
                const response = await fetch('/api/government/hotels/request-quote', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${sessionToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ hotel_id: hotelId })
                });
                
                if (response.ok) {
                    alert('Quote request sent successfully! You will receive a response via email.');
                    
                    // Track successful quote request
                    gtag('event', 'quote_request_success', {
                        'event_category': 'Government Portal',
                        'event_label': 'Hotel Quote Request Success',
                        'custom_parameter_1': 'government_portal',
                        'hotel_id': hotelId
                    });
                } else {
                    const error = await response.json();
                    alert(`Failed to send quote request: ${error.error}`);
                    
                    // Track failed quote request
                    gtag('event', 'quote_request_error', {
                        'event_category': 'Government Portal',
                        'event_label': 'Hotel Quote Request Error',
                        'custom_parameter_1': 'government_portal',
                        'hotel_id': hotelId,
                        'error_message': error.error
                    });
                }
            } catch (error) {
                console.error('Quote request error:', error);
                alert('Failed to send quote request. Please try again.');
                
                // Track quote request exception
                gtag('event', 'quote_request_exception', {
                    'event_category': 'Government Portal',
                    'event_label': 'Hotel Quote Request Exception',
                    'custom_parameter_1': 'government_portal',
                    'hotel_id': hotelId,
                    'error_message': error.message
                });
            }
        }
        
        // View details function
        function viewDetails(hotelId) {
            // Track hotel view event
            if (typeof trackHotelView === 'function') {
                trackHotelView(hotelId);
            }
            
            // Track page view for hotel details
            gtag('event', 'page_view', {
                'event_category': 'Government Portal',
                'event_label': 'Hotel Details Page View',
                'custom_parameter_1': 'government_portal',
                'page_title': 'Hotel Details',
                'page_location': `/hotel-details.html?id=${hotelId}`
            });
            
            window.open(`/hotel-details.html?id=${hotelId}`, '_blank');
        }
        
        // Country data organized by continent
        const countriesByContinent = {
            'North America': [
                { code: 'CA', name: 'Canada' },
                { code: 'MX', name: 'Mexico' }
            ],
            'Europe': [
                { code: 'UK', name: 'United Kingdom' },
                { code: 'DE', name: 'Germany' },
                { code: 'FR', name: 'France' },
                { code: 'IT', name: 'Italy' },
                { code: 'ES', name: 'Spain' },
                { code: 'NL', name: 'Netherlands' },
                { code: 'BE', name: 'Belgium' },
                { code: 'CH', name: 'Switzerland' },
                { code: 'AT', name: 'Austria' },
                { code: 'IE', name: 'Ireland' },
                { code: 'PT', name: 'Portugal' },
                { code: 'SE', name: 'Sweden' },
                { code: 'NO', name: 'Norway' },
                { code: 'DK', name: 'Denmark' },
                { code: 'FI', name: 'Finland' },
                { code: 'PL', name: 'Poland' },
                { code: 'CZ', name: 'Czech Republic' },
                { code: 'HU', name: 'Hungary' },
                { code: 'GR', name: 'Greece' },
                { code: 'RO', name: 'Romania' },
                { code: 'BG', name: 'Bulgaria' },
                { code: 'HR', name: 'Croatia' },
                { code: 'SI', name: 'Slovenia' },
                { code: 'SK', name: 'Slovakia' },
                { code: 'LT', name: 'Lithuania' },
                { code: 'LV', name: 'Latvia' },
                { code: 'EE', name: 'Estonia' }
            ],
            'Asia': [
                { code: 'JP', name: 'Japan' },
                { code: 'KR', name: 'South Korea' },
                { code: 'SG', name: 'Singapore' },
                { code: 'TH', name: 'Thailand' },
                { code: 'PH', name: 'Philippines' },
                { code: 'IN', name: 'India' },
                { code: 'MY', name: 'Malaysia' },
                { code: 'ID', name: 'Indonesia' },
                { code: 'VN', name: 'Vietnam' },
                { code: 'TW', name: 'Taiwan' },
                { code: 'HK', name: 'Hong Kong' },
                { code: 'MO', name: 'Macau' },
                { code: 'BD', name: 'Bangladesh' },
                { code: 'PK', name: 'Pakistan' },
                { code: 'LK', name: 'Sri Lanka' },
                { code: 'MM', name: 'Myanmar' },
                { code: 'KH', name: 'Cambodia' },
                { code: 'LA', name: 'Laos' },
                { code: 'MN', name: 'Mongolia' },
                { code: 'NP', name: 'Nepal' },
                { code: 'BT', name: 'Bhutan' },
                { code: 'MV', name: 'Maldives' }
            ],
            'Oceania': [
                { code: 'AU', name: 'Australia' },
                { code: 'NZ', name: 'New Zealand' },
                { code: 'FJ', name: 'Fiji' },
                { code: 'PG', name: 'Papua New Guinea' },
                { code: 'NC', name: 'New Caledonia' },
                { code: 'VU', name: 'Vanuatu' },
                { code: 'SB', name: 'Solomon Islands' },
                { code: 'TO', name: 'Tonga' },
                { code: 'WS', name: 'Samoa' },
                { code: 'KI', name: 'Kiribati' },
                { code: 'TV', name: 'Tuvalu' },
                { code: 'NR', name: 'Nauru' },
                { code: 'PW', name: 'Palau' },
                { code: 'FM', name: 'Micronesia' },
                { code: 'MH', name: 'Marshall Islands' }
            ],
            'South America': [
                { code: 'BR', name: 'Brazil' },
                { code: 'AR', name: 'Argentina' },
                { code: 'CL', name: 'Chile' },
                { code: 'CO', name: 'Colombia' },
                { code: 'PE', name: 'Peru' },
                { code: 'VE', name: 'Venezuela' },
                { code: 'EC', name: 'Ecuador' },
                { code: 'BO', name: 'Bolivia' },
                { code: 'PY', name: 'Paraguay' },
                { code: 'UY', name: 'Uruguay' },
                { code: 'GY', name: 'Guyana' },
                { code: 'SR', name: 'Suriname' },
                { code: 'GF', name: 'French Guiana' }
            ],
            'Africa': [
                { code: 'ZA', name: 'South Africa' },
                { code: 'EG', name: 'Egypt' },
                { code: 'NG', name: 'Nigeria' },
                { code: 'KE', name: 'Kenya' },
                { code: 'GH', name: 'Ghana' },
                { code: 'MA', name: 'Morocco' },
                { code: 'TN', name: 'Tunisia' },
                { code: 'DZ', name: 'Algeria' },
                { code: 'ET', name: 'Ethiopia' },
                { code: 'UG', name: 'Uganda' },
                { code: 'TZ', name: 'Tanzania' },
                { code: 'ZW', name: 'Zimbabwe' },
                { code: 'BW', name: 'Botswana' },
                { code: 'NA', name: 'Namibia' },
                { code: 'ZM', name: 'Zambia' },
                { code: 'MW', name: 'Malawi' },
                { code: 'MZ', name: 'Mozambique' },
                { code: 'MG', name: 'Madagascar' },
                { code: 'MU', name: 'Mauritius' },
                { code: 'SC', name: 'Seychelles' },
                { code: 'RW', name: 'Rwanda' },
                { code: 'BI', name: 'Burundi' },
                { code: 'DJ', name: 'Djibouti' },
                { code: 'SO', name: 'Somalia' },
                { code: 'ER', name: 'Eritrea' },
                { code: 'SD', name: 'Sudan' },
                { code: 'SS', name: 'South Sudan' },
                { code: 'CF', name: 'Central African Republic' },
                { code: 'TD', name: 'Chad' },
                { code: 'NE', name: 'Niger' },
                { code: 'ML', name: 'Mali' },
                { code: 'BF', name: 'Burkina Faso' },
                { code: 'CI', name: 'Ivory Coast' },
                { code: 'LR', name: 'Liberia' },
                { code: 'SL', name: 'Sierra Leone' },
                { code: 'GN', name: 'Guinea' },
                { code: 'GW', name: 'Guinea-Bissau' },
                { code: 'GM', name: 'Gambia' },
                { code: 'SN', name: 'Senegal' },
                { code: 'MR', name: 'Mauritania' },
                { code: 'CV', name: 'Cape Verde' },
                { code: 'ST', name: 'S√£o Tom√© and Pr√≠ncipe' },
                { code: 'GQ', name: 'Equatorial Guinea' },
                { code: 'GA', name: 'Gabon' },
                { code: 'CG', name: 'Republic of the Congo' },
                { code: 'CD', name: 'Democratic Republic of the Congo' },
                { code: 'AO', name: 'Angola' },
                { code: 'CM', name: 'Cameroon' }
            ],
            'Middle East': [
                { code: 'AE', name: 'United Arab Emirates' },
                { code: 'SA', name: 'Saudi Arabia' },
                { code: 'IL', name: 'Israel' },
                { code: 'TR', name: 'Turkey' },
                { code: 'IQ', name: 'Iraq' },
                { code: 'IR', name: 'Iran' },
                { code: 'JO', name: 'Jordan' },
                { code: 'LB', name: 'Lebanon' },
                { code: 'SY', name: 'Syria' },
                { code: 'KW', name: 'Kuwait' },
                { code: 'QA', name: 'Qatar' },
                { code: 'BH', name: 'Bahrain' },
                { code: 'OM', name: 'Oman' },
                { code: 'YE', name: 'Yemen' },
                { code: 'AF', name: 'Afghanistan' },
                { code: 'PK', name: 'Pakistan' },
                { code: 'UZ', name: 'Uzbekistan' },
                { code: 'KZ', name: 'Kazakhstan' },
                { code: 'KG', name: 'Kyrgyzstan' },
                { code: 'TJ', name: 'Tajikistan' },
                { code: 'TM', name: 'Turkmenistan' },
                { code: 'AZ', name: 'Azerbaijan' },
                { code: 'AM', name: 'Armenia' },
                { code: 'GE', name: 'Georgia' }
            ]
        };

        // Update country options based on selected continent
        function updateCountryOptions() {
            const continent = document.getElementById('continent').value;
            const countrySelect = document.getElementById('country');
            const countryField = document.getElementById('countryField');
            
            // Clear existing options
            countrySelect.innerHTML = '<option value="">Select Country</option>';
            
            if (continent && countriesByContinent[continent]) {
                // Show country field
                countryField.style.display = 'block';
                
                // Add countries for selected continent
                countriesByContinent[continent].forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.code;
                    option.textContent = country.name;
                    countrySelect.appendChild(option);
                });
            } else {
                // Hide country field if no continent selected
                countryField.style.display = 'none';
            }
        }

        // Toggle location fields based on CONUS/OCONUS selection
        function toggleLocationFields() {
            const locationType = document.getElementById('locationType').value;
            const conusFields = document.getElementById('conusFields');
            const oconusFields = document.getElementById('oconusFields');
            const countryField = document.getElementById('countryField');
            const cityField = document.getElementById('cityField');
            
            // Hide all location fields first
            conusFields.style.display = 'none';
            oconusFields.style.display = 'none';
            countryField.style.display = 'none';
            cityField.style.display = 'none';
            
            // Show appropriate fields based on selection
            if (locationType === 'CONUS') {
                conusFields.style.display = 'block';
                // City field will be shown when state is selected
                checkCityFieldVisibility();
            } else if (locationType === 'OCONUS') {
                oconusFields.style.display = 'block';
                // Country field will be shown when continent is selected
                // City field will be shown when country is selected
                checkCityFieldVisibility();
            } else {
                // No location type selected - hide everything
                conusFields.style.display = 'none';
                oconusFields.style.display = 'none';
                countryField.style.display = 'none';
                cityField.style.display = 'none';
            }
        }
        
        function checkCityFieldVisibility() {
            const locationType = document.getElementById('locationType').value;
            const cityField = document.getElementById('cityField');
            const state = document.getElementById('state').value;
            const country = document.getElementById('country').value;
            
            if (locationType === 'CONUS') {
                // Show city field only if state is selected
                cityField.style.display = state ? 'block' : 'none';
            } else if (locationType === 'OCONUS') {
                // Show city field only if country is selected
                cityField.style.display = country ? 'block' : 'none';
            } else {
                cityField.style.display = 'none';
            }
        }
        
        // Logout function
        function logout() {
            localStorage.removeItem('gov_session');
            window.location.href = '/government-login.html';
        }
        
        // Form validation and field updates
        document.getElementById('locationType').addEventListener('change', toggleLocationFields);
        document.getElementById('continent').addEventListener('change', updateCountryOptions);
        
        // Auto-search on form changes
        document.getElementById('locationType').addEventListener('change', searchHotels);
        document.getElementById('city').addEventListener('input', debounce(searchHotels, 500));
        document.getElementById('state').addEventListener('change', function() {
            checkCityFieldVisibility();
                searchHotels();
            });
        document.getElementById('continent').addEventListener('change', searchHotels);
        document.getElementById('country').addEventListener('change', function() {
            checkCityFieldVisibility();
            searchHotels();
        });
        document.getElementById('checkin').addEventListener('change', searchHotels);
        document.getElementById('checkout').addEventListener('change', searchHotels);
        document.getElementById('rooms').addEventListener('change', searchHotels);
        document.getElementById('keywords').addEventListener('input', debounce(searchHotels, 500));
        
        // Debounce utility
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Initialize
        loadUserInfo();
        
        // Track page view
        gtag('event', 'page_view', {
            'event_category': 'Government Portal',
            'event_label': 'Hotel Search Page',
            'custom_parameter_1': 'government_portal',
            'page_title': 'Government Hotel Search',
            'page_location': window.location.href
        });
        
        // Initial search with default filters
        setTimeout(searchHotels, 500);
    </script>
</body>
</html>